<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLM-Guided Multi-Agent Robot Navigation System: sim_app/sensor_fetch.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LLM-Guided Multi-Agent Robot Navigation System<span id="projectnumber">&#160;Mohamad-Dirani-23074344</span>
   </div>
   <div id="projectbrief">A Python-based simulation of coordinated robot navigation in CoppeliaSim using A*, GPT-4 voice commands, and SICK S300 sensors for obstacle avoidance.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('sensor__fetch_8py_source.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">sensor_fetch.py</div></div>
</div><!--header-->
<div class="contents">
<a href="sensor__fetch_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno"><a class="line" href="namespacesensor__fetch.html">    1</a></span><span class="comment"># sim_app/sensor_fetch.py</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">import</span> base64</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="keyword">import</span> cbor2</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">from</span> sim_app.shared <span class="keyword">import</span> latest_data</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">from</span> sim_app.shared <span class="keyword">import</span> all_sensor_data</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="foldopen" id="foldopen00007" data-start="" data-end="">
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno"><a class="line" href="namespacesensor__fetch.html#a13ccc4a5a4fa388889c0357cc3a80547">    7</a></span><span class="keyword">async def </span><a class="code hl_function" href="namespacesensor__fetch.html#a13ccc4a5a4fa388889c0357cc3a80547">fetch_sensor_data</a>(sim, signal_name):</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="stringliteral">    Fetches and decodes sensor data from a simulation signal.</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="stringliteral">    This asynchronous function retrieves a base64-encoded, CBOR-serialized list of sensor data points from the specified signal in the simulation. It decodes and deserializes the data, updates global dictionaries with the latest and accumulated sensor data, and finds the point with the closest distance value.</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="stringliteral">    Args:</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="stringliteral">        sim: The simulation object providing the `getStringSignal` coroutine method.</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="stringliteral">        signal_name (str): The name of the signal to fetch sensor data from.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="stringliteral">        tuple or None: A tuple (x, y, dist) representing the coordinates and distance of the closest point, or None if no valid data is found.</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="stringliteral">    Side Effects:</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="stringliteral">        Updates the global `latest_data` and `all_sensor_data` dictionaries with the latest and accumulated sensor data for the given signal.</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="stringliteral">    Raises:</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="stringliteral">        None. Exceptions are caught and logged; function returns None on failure.</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    raw = await sim.getStringSignal(signal_name)</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>    <span class="keywordflow">if</span> raw:</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>            decoded = base64.b64decode(raw)</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>            points = cbor2.loads(decoded)</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>            <span class="keywordflow">if</span> isinstance(points, list):</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>                latest_data[signal_name] = points</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>                all_sensor_data[signal_name].extend(points)</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>                latest_data[signal_name] = []</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>            points = latest_data.get(signal_name, [])</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>            <span class="keywordflow">if</span> points:</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>                closest_dist = float(<span class="stringliteral">&#39;inf&#39;</span>)</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>                closest_point = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>                <span class="keywordflow">for</span> pt <span class="keywordflow">in</span> points:</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>                    <span class="keywordflow">if</span> len(pt) &gt;= 4:</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>                        x, y, z, dist = pt[:4]</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>                        <span class="keywordflow">if</span> dist &lt; closest_dist:</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>                            closest_dist = dist</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>                            closest_point = (x, y, dist)</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>                        print(f<span class="stringliteral">&quot;⚠️ Unexpected point format in {signal_name}: {pt}&quot;</span>)</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>                <span class="keywordflow">return</span> closest_point <span class="keywordflow">if</span> closest_point <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>                <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>            print(f<span class="stringliteral">&quot;❌ Failed to decode sensor data for {signal_name}: {e}&quot;</span>)</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>            latest_data[signal_name] = []</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>        latest_data[signal_name] = []</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
</div>
<div class="ttc" id="anamespacesensor__fetch_html_a13ccc4a5a4fa388889c0357cc3a80547"><div class="ttname"><a href="namespacesensor__fetch.html#a13ccc4a5a4fa388889c0357cc3a80547">sensor_fetch.fetch_sensor_data</a></div><div class="ttdeci">fetch_sensor_data(sim, signal_name)</div><div class="ttdef"><b>Definition</b> <a href="#l00007">sensor_fetch.py:7</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_6d99e2fc421e546b85342da8ced7f59c.html">sim_app</a></li><li class="navelem"><a href="sensor__fetch_8py.html">sensor_fetch.py</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
